import{d as U,t as j,a7 as G,aD as H,y as Q,C as X,aH as Y,aI as P,I as z,o as J,b as K,f as Z}from"./modules/vue-DJHzUJr2.js";import{u as tt}from"./slidev/context-DI1JsmRv.js";import{aE as q,_ as et}from"./index-B9h3ow_G.js";let st=/(-?(?:\d+\.?\d*|\d*\.?\d+)(?:e[-+]?\d+)?)\s*([\p{L}]*)/uig;a.nanosecond=a.ns=1/1e6;a.µs=a.μs=a.us=a.microsecond=1/1e3;a.millisecond=a.ms=a[""]=1;a.second=a.sec=a.s=a.ms*1e3;a.minute=a.min=a.m=a.s*60;a.hour=a.hr=a.h=a.m*60;a.day=a.d=a.h*24;a.week=a.wk=a.w=a.d*7;a.month=a.b=a.d*(365.25/12);a.year=a.yr=a.y=a.d*365.25;function a(p="",_="ms"){var b=null;p=(p+"").replace(/(\d)[,_](\d)/g,"$1$2");var B=p[0]==="-";return p.replace(st,function(T,M,E){E=D(E),E&&(b=(b||0)+Math.abs(parseFloat(M,10))*E)}),b&&b/(D(_)||1)*(B?-1:1)}function D(p){return a[p]||a[p.toLowerCase().replace(/s$/,"")]}const R=new CSSStyleSheet;R.replaceSync(`
:root {
	--anim-show-duration: 400ms;
	--anim-hide-duration: 100ms;
	--anim-step-opacity: 0.15;
}
.anim-shown { opacity: 1; transition: all var(--anim-show-duration); }
.anim-hidden { opacity: 0; transition: all var(--anim-hide-duration); }
.anim-nowable, .anim-nowable ~ * { transition: all var(--anim-show-duration) ease-out; }
.anim-notnow, .anim-now ~ * { opacity: var(--anim-step-opacity); transition-duration: 0ms !important; transition-timing-function: ease-out; }
/* css is tricky (and imperfect) with nested lists... */
`);const O=p=>{p.adoptedStyleSheets=p.adoptedStyleSheets.filter(_=>!_.__isAnimStyleSheet),R.__isAnimStyleSheet=!0,p.adoptedStyleSheets.push(R)};O(globalThis.document);const N=(p,_,b,B=!0)=>{b.indexOf("::part(");const T=u=>{if(u.indexOf("::shadow")!==-1)return u.split("::shadow");if(u.indexOf("::part(")!==-1){const A=u.split("::part(");return A.length!==2&&globalThis.console.log("WARNING: non-2-length parts",A),A[0]===""&&globalThis.console.log("WARNING: performance risk with non-prefixed ::part()",u),A[0].indexOf(",")!==-1&&globalThis.console.log("WARNING: found a comma on the left of ::part(), this might not be well handled",u),[A[0],"::part("+A[1]]}return[u]};let[M,E]=T(b);if(E===void 0)return p?_.querySelectorAll(b):_.querySelector(b);let w=[..._.querySelectorAll(M||"*")];return globalThis.console.log("1",p,w),B&&w.some(u=>u.shadowRoot)&&w.forEach(u=>u.shadowRoot?O(u.shadowRoot):"pass"),E===""?w=w.map(u=>{var A;return(A=u.shadowRoot)==null?void 0:A.children}):w=w.map(u=>{var A;return(A=u.shadowRoot)==null?void 0:A.querySelectorAll(E)}),globalThis.console.log("2",p,w),w=w.flatMap(u=>u?[...u]:[]),globalThis.console.log("3",p,w),p?w:w[0]??null},nt=U({__name:"Anim",props:{spec:{default:()=>"@step 1-"},at:{type:[String,Number],default:"+1"},dur:{type:String,default:"300ms"}},setup(p,{expose:_}){_();const{$clicksContext:b}=tt(),B=p,T=(e,s=!1)=>t=>{for(const o in e)s||e[o]===void 0?t.style.removeProperty(o):t.style.setProperty(o,e[o])},M={show:{doit({all:e},s){e(s,t=>t.classList.add("anim-shown")),e(s,t=>t.classList.remove("anim-hidden"))},undo({all:e},s){e(s,t=>t.classList.add("anim-hidden")),e(s,t=>t.classList.remove("anim-shown"))}},hide:{doit({all:e},s){e(s,t=>t.classList.remove("anim-shown")),e(s,t=>t.classList.add("anim-hidden"))},undo({all:e},s){e(s,t=>t.classList.remove("anim-hidden")),e(s,t=>t.classList.add("anim-shown"))}},highlight:{doit({all:e},s){e(s,t=>t.classList.remove("dishonored")),e(s,t=>t.classList.remove("dishonored2")),e(s,t=>t.classList.add("highlighted"))},undo({all:e},s){e(s,t=>t.classList.remove("highlighted")),e(s,t=>t.classList.add("dishonored")),e(s,t=>t.classList.add("dishonored2"))}},unhighlight:{doit({all:e},s){e(s,t=>t.classList.remove("highlighted")),e(s,t=>t.classList.add("dishonored")),e(s,t=>t.classList.add("dishonored2"))},undo({all:e},s){e(s,t=>t.classList.remove("dishonored")),e(s,t=>t.classList.remove("dishonored2")),e(s,t=>t.classList.add("highlighted"))}},inlineShow:{doit({all:e},s){e(s,t=>t.style.opacity=1)},undo({all:e},s){e(s,t=>t.style.opacity=0)}},inlineHide:{doit({all:e},s){e(s,t=>t.style.opacity=0)},undo({all:e},s){e(s,t=>t.style.opacity=1)}},addClass:{doit({all:e},s,t){e(t,o=>o.classList.add(s))},undo({all:e},s,t){e(t,o=>o.classList.remove(s))}},removeClass:{doit({all:e},s,t){e(t,o=>o.classList.remove(s))},undo({all:e},s,t){e(t,o=>o.classList.add(s))}},step:{init({el:e}){},doit({el:e,all:s,querySelectorAll:t},o){e.classList.remove("anim-notnow"),s(".anim-now",d=>d.classList.remove("anim-now"));let r=t(".step")[o-1];for(;r&&r!==e;)r.classList.add("anim-now"),r=r.parentElement},undo({all:e,querySelector:s,querySelectorAll:t,el:o,willDo:r},d){{let h=t(".step")[d-1];for(;h&&h!==o;)h.classList.add("anim-nowable"),h=h.parentElement}o.classList.add("anim-nowable"),o.classList.remove("anim-notnow"),e(".anim-now",h=>h.classList.remove("anim-now"));let l=s(".step0");for(l===null&&o.classList.add("anim-notnow");l&&l!==o;)l.classList.add("anim-now"),l=l.parentElement}},viewBoxAs:{init({querySelector:e},s){const t=e(s);if(t!==null&&t.viewportElement!==void 0){const o=t.viewportElement||t;o.baseViewBox===void 0?o.baseViewBox=o.getAttribute("viewBox")??"":o.setAttribute("viewBox",o.baseViewBox)}},doit({querySelector:e,fast:s},t,o){const r=a(o,"ms"),d=(i,m,f)=>[m*i.a+f*i.c+i.e,m*i.b+f*i.d+i.f],l=i=>i[0].map((m,f)=>i.map(n=>n[f])),h=(i,m)=>{const f=m.getScreenCTM().inverse().multiply(i.getScreenCTM()),n=i.getBBox(),c=[[n.x,n.y],[n.x+n.width,n.y],[n.x+n.width,n.y+n.height],[n.x,n.y+n.height]],y=l(c.map(([v,g])=>d(f,v,g))),L=Math.min(...y[0]),S=Math.min(...y[1]);return[L,S,Math.max(...y[0])-L,Math.max(...y[1])-S]},x=e(t);if(x!==null&&x.viewportElement!==void 0){const i=x.viewportElement||x;if(i.getScreenCTM()===null)return;const m=h(x,i);if(s)i.setAttribute("viewBox",m.join(" "));else{const f=i.getAttribute("viewBox");i.currentViewBoxAnimate=P({from:f,to:m.join(" "),duration:r,onUpdate:n=>i.setAttribute("viewBox",n)})}}},undo({querySelector:e},s){var o,r;const t=e(s);if(t!==null&&t.viewportElement!==void 0){const d=t.viewportElement||t;(r=(o=d.currentViewBoxAnimate)==null?void 0:o.stop)==null||r.call(o),d.currentViewBoxAnimate=void 0}}},moveAlong:{init({all:e},s,t,o){e(o,r=>{r.dataNextStart=[0,0],r.viewportElement!==void 0?r.baseTransform===void 0?r.baseTransform=r.getAttribute("transform")??"":r.setAttribute("transform",r.baseTransform):r.baseTransform===void 0?r.baseTransform=r.style.transform:r.style.transform=r.baseTransform})},doit({all:e,fast:s,querySelector:t},o,r,d){const l=a(r,"ms"),h=o.startsWith("-"),x=t(o.substr(h?1:0));x!==null&&e(d,i=>{let m=i.dataNextStart;const f=x.getTotalLength(),n=x.getPointAtLength(h?f:0),c=x.getPointAtLength(h?0:f);i.dataNextStart=[m[0]+c.x-n.x,m[1]+c.y-n.y];const y=L=>{const S=x.getPointAtLength((h?1-L:L)*f);i.viewportElement!==void 0?i.setAttribute("transform",`translate(${S.x-n.x+m[0]} ${S.y-n.y+m[1]}) ${i.baseTransform}`):i.style.transform=`translate(${S.x-n.x+m[0]}px, ${S.y-n.y+m[1]}px) ${i.baseTransform}`};if(s){y(1);return}i.currentMoveAlongAnimate=P({from:0,to:1,onUpdate:y,duration:l})})},undo({all:e},s,t,o){e(o,r=>{var d,l;(l=(d=r.currentMoveAlongAnimate)==null?void 0:d.stop)==null||l.call(d),r.currentMoveAlongAnimate=void 0})}}};function E(e=5){const s=[],t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",o=t.length;for(let r=0;r<e;r++)s.push(t.charAt(Math.floor(Math.random()*o)));return s.join("")}const w=e=>s=>{function t(n){return s.startsWith(n)?(s=s.substring(n.length),!0):!1}function o(n){const c=s.match(n);if(c==null)throw`Cannot match «${n}» in «${s}»`;const y=s.substring(0,c.index);return s=s.substring(c.index+c[0].length),y}if(t("++"))return["inlineShow",s];if(t("--"))return["inlineHide",s];if(t("+"))return["show",s];if(t("-"))return["hide",s];if(t("@+class "))return["addClass",o(/ +/),s];if(t("@-class "))return["removeClass",o(/ +/),s];if(t("@along "))return["moveAlong",o(/ +/),e.defaultDuration,s];if(t("@alongd ")){const n=o(/ +/),c=o(/ +/);return["moveAlong",n,c,s]}if(t("@viewbox "))return["viewBoxAs",s,e.defaultDuration];if(t("@viewboxd "))return["viewBoxAs",o(/ +/),s];if(t("@step ")){const n=q(e.nStepElements()+1,s);return n.length>1&&e.forbidComposite?(alert("@steps is not allowed here (e.g. in ^ separated steps), use @step"),[]):n.length===1?["step",n[0]]:n.map(c=>[["step",c]])}const r=".mtable",d=".mtable:first-of-type",l=">* .vlist>span:not(.vlist .vlist span)",h=r+l;if(t("@math ")){let n=s,c="",y=!1,L=!0;try{n=o(/ +/),c=s+" "}catch{}if(n.startsWith("[")){if(!n.trimEnd().endsWith("]"))return alert("@math with a range spec must end in ] (and must not contain spaces)"),[];L=!1,n=n.trimEnd().slice(1,-1)}else if(n.startsWith("{")){if(!n.trimEnd().endsWith("}"))return alert("@math with a slidev range spec must end in } (and must not contain spaces)"),[];y=!0,n=n.trimEnd().slice(1,-1)}if(y){const S=n.split(/\|/g).map(g=>q(e.nMathElements(c),g)),v=[];for(const g of S){const C=[];v.push(C);for(const k of e.elValue().querySelectorAll(c+d))k.querySelectorAll(":scope "+l).forEach((F,$)=>{C.push([g.includes($+1)?"highlight":"unhighlight",c+h+":nth-of-type("+($+1)+")"])})}return v}else{const S=n.split(/\|/g).map(g=>q(e.nMathElements(c),g));let v=[];for(const g of S)v.push(g.map(C=>["show",c+h+":nth-of-type("+C+")"]));return L&&(v=v.flat().map(g=>[g])),v.length>1&&e.forbidComposite?(alert("@math with a range is not allowed here (e.g. in ^ separated steps)"),[]):v}}const x="pre.slidev-code>code",i="pre.slidev-code:first-of-type>code",m=">span.line",f=x+m;if(t("@code ")){let n=s,c="",y=!1,L=!0;try{n=o(/ +/),c=s+" "}catch{}if(n.startsWith("[")){if(!n.trimEnd().endsWith("]"))return alert("@code with a range spec must end in ] (and must not contain spaces)"),[];L=!1,n=n.trimEnd().slice(1,-1)}else if(n.startsWith("{")){if(!n.trimEnd().endsWith("}"))return alert("@code with a slidev range spec must end in } (and must not contain spaces)"),[];y=!0,n=n.trimEnd().slice(1,-1)}if(y){const S=n.split(/\|/g).map(g=>q(e.nCodeElements(c),g)),v=[];for(const g of S){const C=[];v.push(C);for(const k of e.elValue().querySelectorAll(c+i))k.querySelectorAll(":scope "+m).forEach((F,$)=>{C.push([g.includes($+1)?"highlight":"unhighlight",c+f+":nth-of-type("+($+1)+")"])})}return v}else{const S=n.split(/\|/g).map(g=>q(e.nCodeElements(c),g));let v=[];for(const g of S)v.push(g.map(C=>["show",c+f+":nth-of-type("+C+")"]));return L&&(v=v.flat().map(g=>[g])),v.length>1&&e.forbidComposite?(alert("@code with a range is not allowed here (e.g. in ^ separated steps)"),[]):v}}return s.startsWith("@")&&alert("Unhandled @ animation: "+s),["show",s]},u=j(),A=z(),V=e=>{const{dur:s}=B,t={defaultDuration:s,elValue:()=>e,nStepElements:()=>e.querySelectorAll(".step").length,nMathElements:(d="")=>Math.max(...[...e.querySelectorAll(d+".mtable>* .vlist")].map(l=>l.querySelectorAll(":scope>span:not(.vlist .vlist span)").length)),nCodeElements:d=>Math.max(...[...e.querySelectorAll(d+" pre.slidev-code:first-of-type>code")].map(l=>l.querySelectorAll(":scope>span.line").length))},o=B.spec.trim();if(o.length==0)return[];const r=[];return o.split(/\| /g).forEach(d=>{if(d.trim().match(/ +\^ +/)){const l=[];r.push(l),d.trim().split(/ +\^ +/g).map(w({...t,forbidComposite:!0})).forEach(h=>{typeof(h==null?void 0:h[0])=="string"?l.push(h):(h.length>2&&alert("Too many steps while forbidComposite:true was passed"),l.push(...h[0]))})}else{let l=w(t)(d.trim());typeof(l==null?void 0:l[0])=="string"?r.push([l]):r.push(...l)}}),r},W=j(()=>{});G(()=>{const e=V(u.value),s=E(),t=b.calculateSince(B.at,e.length);b.register(s,t),H(()=>b.unregister(s));const o=Q(()=>t?Math.max(0,b.current-t.start+1):999999);let r;W.value=()=>{var h,x;if(!u.value){r=void 0;return}const d=r;r=o.value;const l={all:(i,m)=>N(!0,u.value,i).forEach(m),querySelector:i=>N(!1,u.value,i),querySelectorAll:i=>N(!0,u.value,i),el:u.value};for(let i=e.length-1;i>=0;--i)for(const m of e[i]){const[f,...n]=m;M[f]?(x=(h=M[f]).init)==null||x.call(h,l,...n):alert("Action not found: "+f)}for(let i=e.length-1;i>=0;--i){const m=i<o.value;for(const f of e[i]){const[n,...c]=f;M[n].undo({...l,willDo:m},...c)}}for(let i=0;i<o.value;++i){const m=o.value-d,f=i<o.value-1||m<1||m>1||d===void 0&&o.value==e.length-1,n=i==o.value-1;for(const c in e[i]){const y=e[i][c],[L,...S]=y;M[L].doit({...l,fast:f,last:n},...S)}}},X(W.value)}),Y("notifyAsyncDone",W);const I={clicks:b,props:B,applyStyle:T,actions:M,makeid:E,parsePart:w,el:u,vm:A,computeSteps:V,updateAll:W};return Object.defineProperty(I,"__isScriptSetup",{enumerable:!1,value:!0}),I}}),ot={ref:"el"};function it(p,_,b,B,T,M){return J(),K("div",ot,[Z(p.$slots,"default")],512)}const ct=et(nt,[["render",it],["__file","/home/twilight/projects/deck-js-stuffs/slidev-addon-ultracharger-demo/node_modules/.pnpm/@twitwi+slidev-addon-ultracharger@1.1.3/node_modules/@twitwi/slidev-addon-ultracharger/components/Anim.vue"]]);export{ct as A};
